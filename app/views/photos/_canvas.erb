<script>
  let img;

  const settings = {
    dimensions: [ 2048, 2048 ],
    parent: document.getElementById("canvas-sketch"),
  };

  const sketch = ({width, height, canvas}) => {
    return ({ context, width, height }) => {
        context.fillStyle = 'red';
        context.fillRect(0, 0, width, height);
        context.drawImage(img, 0, 0, width, height);
      };
  };

  const loadImage = async (url) => {
    return new Promise((resolve, reject) => {
      const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = () => reject();
        img.src = url;
      });
  };

  const start = async () => {
    img = await loadImage('<%= (rails_storage_proxy_path(photo.image))%>')
      canvasSketch(sketch, settings)
    }

  start();

</script>
